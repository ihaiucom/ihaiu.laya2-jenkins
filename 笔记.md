## Jenkins 相关文档

[Jenkins官方文档]  
https://github.com/ihaiucom/Jenkinsdocs

[Jenkins教程]  
https://jenkins.io/zh/doc/book/pipeline/#scripted-pipeline-fundamentals

[第十章-流水线实践(二)] 
https://github.com/ihaiucom/Jenkinsdocs/blob/master/chapter/第十章-流水线实践(二).md

[流水线语法] 
https://jenkins.io/zh/doc/book/pipeline/syntax/

## Jenkins 插件提速

[Jenkins安装插件提速]
https://www.cnblogs.com/hellxz/p/jenkins_install_plugins_faster.html



```

打开 D:\Jenkins\.jenkins\updates\default.json

http://updates.jenkins-ci.org/download/
替换
https://mirrors.tuna.tsinghua.edu.cn/jenkins/



http://www.google.com/
替换
https://www.baidu.com/
```


## Jenkins Pipline 

```
String workspace="D:/Jenkins/GameJJSG/"
pipeline 
{
   agent 
   {
       node 
       {
            label "master"						// 设置运行机器节点标签
            customWorkspace "${workspace}" 		// 自定义在工作空间 
       }
   }

   options 
   {
   		timestamps()  							// 日志会有时间
	  	timeout(time: 20, unit: 'SECONDS') 		// 设置超时时间
	  	retry(2)								// 设置重复次数
	  	disableConcurrentBuilds()				// 不允许并发构建
	  	skipDefaultCheckout true				// 删除隐试checkou scm语句
	}


   stages 
   {
      stage('步骤一:拉取GIT') 
      {
         steps 
         {
         	echo "开始拉取GIT"
            git credentialsId: '647b7b11-5185-4289-843d-77cc8dfbc945', url: 'git@github.com:ihaiucom/ihaiu.laya2-jenkins.git'
         }
      }

      stage('步骤二：Say Hello') 
      {
         steps 
         {
            echo 'Begin Say'
         	timeout(time: 3, unit: 'SECONDS')  // 设置超时时间
         	{
            	echo 'Hello World'
			}
         }
      }
   }

   post 
   {
	  always 
	  {
	  	script
	  	{

	    	echo "always 无论流水线或阶段的完成状态如何，都允许在 post 部分运行该步骤。"
	  	}
	  }

	  unstable 
	  {
	  	echo "unstable 只有当前流水线或阶段的完成状态为unstable，才允许在 post 部分运行该步骤, 通常由于测试失败,代码违规等造成。通常web UI是黄色。"
	  }

	  notBuilt 
	  {
	    echo "notBuilt"
	  }

	  cleanup 
	  {
	    echo "cleanup"
	  }

	  regression 
	  {
	    echo "regression"
	  }

	  aborted 
	  {
	    echo "aborted 只有当前流水线或阶段的完成状态为aborted，才允许在 post 部分运行该步骤, 通常由于流水线被手动的aborted。通常web UI是灰色"
	  }

	  success 
	  {
	  	script
	  	{

	  		currentBuild.description += "\n 构建成功"
	    	echo "success 只有当前流水线或阶段的完成状态为success，才允许在 post 部分运行该步骤, 通常web UI是蓝色或绿色。"
	  	}
	  }

	  failure 
	  {
	    echo "failure 只有当前流水线或阶段的完成状态为failure，才允许在 post 部分运行该步骤, 通常web UI是红色。"
	  }

	  unsuccessful 
	  {
	    echo "unsuccessful"
	  }

	  fixed 
	  {
	    echo "fixed"
	  }

	  changed 
	  {
	    echo "changed 只有当前流水线或阶段的完成状态与它之前的运行不同时，才允许在 post 部分运行该步骤。"
	  }
	}



}


```


## 安装nodejs
http://nodejs.cn/

## 安装cnpm
https://npm.taobao.org/

npm install -g cnpm --registry=https://registry.npm.taobao.org


## 安装gulp
https://www.cnblogs.com/bobo1/p/10918641.html

https://www.cnblogs.com/limitcode/p/7906447.html

cnpm install -g gulp
cnpm install --save-dev gulp
cnpm install gulp
cnpm install --save gulp

## 安装layaair2-cmd
https://npm.taobao.org/package/layaair2-cmd

cnpm install layaair2-cmd -g
cnpm install layaair2-cmd
cnpm install --save layaair2-cmd


node_modules\.bin\layaair2-cmd compile -w D:\zengfeng\githubs\ihaiu.laya2-jenkins\LayaGame24
node_modules\.bin\layaair2-cmd publish -c web -w D:\zengfeng\githubs\ihaiu.laya2-jenkins\LayaGame24
node_modules\.bin\layaair2-cmd publish -c wxgame -w D:\zengfeng\githubs\ihaiu.laya2-jenkins\LayaGame24


layaair2-cmd compile -w D:\zengfeng\githubs\ihaiu.laya2-jenkins\LayaGame24


## 微信

### 配置电脑环境变量

* PATH加入微信小游戏目录 D:\Program Files (x86)\Tencent\微信web开发者工具
* 重启Jenkins

### 配置打开微信小游戏IDE

* 打开等jenkins运行结束后ide就关闭了。还不知道怎么设置让他一直打开

* learn_wx_cmd_open
命令行打开微信小游戏IDE

```
pipeline {
   agent any

   stages {
      stage('微信IDE--打开') {
         steps {
            bat label: '', script: 
            '''
            echo %PATH%
            cli.bat --port 3000 -o D:/zengfeng/GameJJSGH5/client/client/GameWX/wxgame 
            '''
         }
      }
   }
}

```


* learn_wx_bat_open
使用外部bat文件打开微信IDE

```
pipeline {
   agent any

   stages {
      stage('微信IDE--打开') {
         steps {
            bat label: '', script: 
            '''
            echo %JENKINS_HOME%/../cmd
            cd %JENKINS_HOME%/../cmd
            cli_open.bat
            '''
         }
      }
   }
}

```


D:\Jenkins\cmd\cli_open.bat

```
rem https://developers.weixin.qq.com/miniprogram/dev/devtools/cli.html
set PATH=%PATH%;D:\Program Files (x86)\Tencent\微信web开发者工具
rem echo %PATH%
cli.bat --port 3000 -o
pause

```




### 配置微信小游戏登录
* learn_wx_cmd_login
微信IDE--登录


```
pipeline {
   agent any

   stages {
      stage('微信IDE--登录') {
         steps {
            bat label: '', script: 
            '''
            (
                echo '<a target="_blank" href="http://127.0.0.1:3000/login">http://127.0.0.1:3000/login</a>'
            	cli --port 3000 -o
            	cli -l  --login-qr-output base64
            	
            )
            '''
         }
      }
   }
}
```






### 配置微信小游戏发布


```

pipeline {
   agent any

   stages {
      stage('微信IDE--打开') {
         steps {
            bat label: '', script: 
            '''
            echo %PATH%
            cli.bat --port 3000 -o D:/zengfeng/GameJJSGH5/client/client/GameWX/wxgame 
            '''
         }
      }
      
      
      stage('微信IDE--上传') {
         steps {
            bat label: '', script: 
            '''
            cli.bat -u 1.0.0@D:/zengfeng/GameJJSGH5/client/client/GameWX/wxgame --upload-desc 'initial release' --upload-info-output D:/zengfeng/githubs/ihaiu.laya2-jenkins/_learn_wxgame/info.json
            '''
         }
      }
   }
}


```


## Jenkins 相关插件
* AnsiColor 日志颜色

## Jenkins 中文乱码

[Jenkins控制台日志出现中文乱码解决方法]
https://blog.csdn.net/chenzhi5174/article/details/100718991

[解决jenkins控制台中文乱码问题]
https://www.cnblogs.com/gaigaige/p/6835084.html

## Jenkins 启动支持中文


```
set JENKINS_HOME=%cd%/.jenkins
echo %JENKINS_HOME%
java -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-8 -jar jenkins.war --httpPort=9090
pause
```



## Jenkins 设置支持html
https://www.bilibili.com/video/av52163638?p=7


* http://localhost:9090/configure
Default Content Type ： HTML (text/html)

* http://localhost:9090/configureSecurity/
Markup Formatter ： Safe HTML




## Jenkins Email 邮件通知
https://www.bilibili.com/video/av52163638?p=8